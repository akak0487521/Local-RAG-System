<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RAG Chat — Chat UI + 參數面板</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="layout">
    <!-- 左：側欄（會話清單） -->
    <aside class="sidebar">
      <div class="side-top">
        <button id="newBtn">＋ 新對話</button>
        <button class="ghost" id="exportBtn">匯出</button>
      </div>
      <div class="side-scroll" id="convList"></div>
      <div class="footer-note">本機儲存：<span class="muted">localStorage</span></div>
    </aside>

    <!-- 中：聊天主區 -->
    <main class="main">
      <div class="header">
        <div class="pill">模型：<code id="modelLabel">(server env)</code></div>
          <div class="pill">語言：<code id="langLabel">zh-tw</code></div>
        <div class="pill">RAG：<span id="ragState">關</span></div>
        <button class="ghost" id="toggleRight">顯示/隱藏右側面板</button>
        <div class="pill" title="版本">v: chat-params-rag-right-2025-08-24</div>
      </div>
      <div id="chat" class="chat"></div>
      <div class="composer">
        <textarea id="input" placeholder="輸入訊息…（Shift+Enter 換行，Enter 送出）"></textarea>
        <button id="sendBtn">送出</button>
        <button class="ghost" id="stopBtn" disabled>停止</button>
        <button class="alt" id="insertSnippetsBtn" title="把已勾選的片段插入到輸入框">插入所選片段</button>
        <button class="ghost" id="clearSelBtn" title="取消所有勾選">清除片段</button>
        <button class="danger" id="answerFromSnippetsBtn" title="不輸入問題，直接根據片段生成">僅用片段回答</button>
      </div>
    </main>

    <!-- 右：參數 + RAG 片段面板（RAG 畫面在右方列） -->
    <aside class="right" id="rightPane">
      <div class="head">
        <strong>參數設定 & RAG 片段</strong>
        <span class="badge" id="selCount">0</span>
        <span class="muted" id="ragHint"></span>
      </div>
      <div class="body">
        <!-- 參數設定 -->
        <div class="section">
          <h3>連線</h3>
          <div class="grid2">
            <div class="row"><label>API Base</label><input id="apiBaseInput" type="text" placeholder="預設同源" /></div>
            <div class="row"><label>x-api-key（可選）</label><input id="apiKeyInput" type="text" placeholder="可留空" /></div>
          </div>
          <div class="row">
            <button id="pingBtn" class="ghost">Ping /health</button>
            <span id="healthTxt" class="muted">尚未檢查</span>
          </div>
        </div>

        <div class="section">
          <h3>生成參數</h3>
          <div class="grid2">
            <div class="row"><label>模式</label><select id="modeSel"><option value="strict">strict（嚴謹）</option><option value="creative" selected>creative（創作）</option></select></div>
            <div class="row"><label>語言</label><select id="langSel"><option value="zh-tw" selected>繁體中文</option><option value="zh-cn">简体中文</option><option value="en">English</option><option value="ja">日本語</option><option value="ko">한국어</option><option value="fr">Français</option></select></div>
            <div class="row"><label>引擎</label><select id="engineSel"><option value="auto" selected>auto（服務端決定）</option><option value="ollama">ollama（本地）</option><option value="openai">openai（雲端）</option></select></div>
            <div class="row"><label>目標字數（可選）</label><input id="lenInput" type="text" placeholder='如 "500-700" 或 "800"' /></div>
            <div class="row"><label>Thread ID（可留空）</label><input id="threadInput" type="text" placeholder="自動產生" /></div>
          </div>
        </div>

        <div class="section">
          <h3>語氣控制器</h3>
          <div class="grid2">
            <div class="row">
              <label>語氣</label>
              <select id="toneSel">
                <option value="neutral" selected>Neutral-Concise</option>
                <option value="teacher">Teacher-Encouraging</option>
                <option value="expert">Expert-Direct</option>
                <option value="playful">Playful-Witty</option>
                <option value="journalistic">Journalistic-Objective</option>
              </select>
            </div>
            <div class="row"><label>直白度 <span id="dirVal">0.7</span></label><input id="dirRange" type="range" min="0" max="1" step="0.1" value="0.7"/></div>
            <div class="row"><label>同理 <span id="empVal">0.6</span></label><input id="empRange" type="range" min="0" max="1" step="0.1" value="0.6"/></div>
            <div class="row"><label>模糊緩衝 <span id="hedVal">0.3</span></label><input id="hedRange" type="range" min="0" max="1" step="0.1" value="0.3"/></div>
            <div class="row"><label>正式度 <span id="forVal">0.5</span></label><input id="forRange" type="range" min="0" max="1" step="0.1" value="0.5"/></div>
          </div>
        </div>

        <div class="section">
          <h3>檢索參數</h3>
          <div class="grid2">
            <div class="row"><label>Top-K：<span id="kVal">6</span></label><input id="kRange" type="range" min="1" max="50" value="6" /></div>
            <div class="row"><label>Rerank</label><select id="rerankSel"><option value="true" selected>開</option><option value="false">關</option></select></div>
            <div class="row"><label>Namespace（可選）</label><input id="nsInput" type="text" placeholder="如 lore / drafts" /></div>
            <div class="row"><label>Canonicality（可選）</label><input id="canonInput" type="text" placeholder="canon / semi / non" /></div>
          </div>
          <div class="row">
            <button id="saveParamsBtn" class="ghost">保存設定</button>
            <button id="resetParamsBtn" class="ghost">重設預設值</button>
          </div>
        </div>

        <!-- RAG 搜尋 + 片段列表（右方列） -->
        <div class="section">
          <h3>資料片段（RAG）</h3>
          <div class="search">
            <input id="q" placeholder="搜尋知識庫或文件…" />
            <button id="searchBtn">搜尋</button>
          </div>
          <div class="controls">
            <label class="toggle"><input type="checkbox" id="ragToggle"/> 啟用 RAG</label>
            <label class="toggle"><input type="radio" name="injectWhere" value="system" checked/> 注入 system</label>
            <label class="toggle"><input type="radio" name="injectWhere" value="user"/> 附在提問後</label>
            <button class="ghost" id="selectAllBtn">全選</button>
            <button class="ghost" id="selectNoneBtn">全不選</button>
            <span class="counter" id="resultInfo"></span>
          </div>
          <div id="hits"></div>
        </div>
      </div>
    </aside>
  </div>

<script type="module" src="main.js"></script>
</body>
</html>

